

\chapter{Análisis de señales}
\section{Adquisición}

Para determinar los requerimientos necesarios para poder analizar los sonidos que emiten los bovinos, nos trasladamos hasta la Faculta de Agronoma en Paysand (EEMAC). 
\bigskip

\section{Materiales}
Para realizar la adquisición de datos utilizamos: 

\begin{itemize}
\item 2 reproductores de mp4, que tienen la opción de grabar archivos de audio en formato wav, frecuencia de muestreo: 8kHz, conversor: 8 bits.
\item 2 radiograbadores de cassette.
\item 2 cassettes (60 y 90 minutos).
\item Micrófono Philips omnidireccional, frecuencia de corte: 10kHz.
\item Micrófono Sony stereo, solapero, frecuencia de corte: 8kHz.
\item Micrófono de PC stereo, con alargue realizado con cable telefónico, frecuencia de corte: 16KHz.
\item PC, frecuencia de muestreo: 48kHz.

\end{itemize}


\bigskip
\section{Ensayos realizados}
\begin{enumerate}
\item \emph{Vaca 1} Radiograbador de casette + casette 60 minutos + micrfono Philips ubicado en el costado de la boca (Ver Figura:\ref{Fig:Ensayos:a}).
\item \emph{Vaca 2} Radiograbador de casette + casette 90 minutos + micrfono Sony ubicado en la hocico (Ver Figura:\ref{Fig:Ensayos:b}). 
\item \emph{Vaca 1} Reproductor de mp4 ubicado arriba del hocico (Ver Figura:\ref{Fig:Ensayos:a}). 
\item \emph{Vaca 2} Reproductor de mp4 ubicado en el costado de la boca (Ver Figura:\ref{Fig:Ensayos:c}).
\item \emph{Vaca 1} Micrófono de PC con alargue, ubicado en la oreja y conectado directamente a la PC (Ver Figura:\ref{Fig:Ensayos:c}).
\item \emph{Vaca 2} Micrófono de PC con alargue, ubicado en la oreja y conectado directamente a la PC (Ver Figura:\ref{Fig:Ensayos:b}).
\end{enumerate}
Con los ensayos 1,2,3 y 6 se obtuvieron muestras para analizar el pastoreo, mientras que con los ensayos 4 y 5 la rumia.

\begin{figure}[H]
  \centering
  \subfigure[Ensayos 1 y 3]{\label{Fig:Ensayos:a}
  \includegraphics[height=6cm]{Imagenes/Ensayo1y3.jpg} } 
  \subfigure[Ensayos 2 y 6]{\label{Fig:Ensayos:b} 
  \includegraphics[height=6cm]{Imagenes/Ensayo2y6.JPG} }
  \subfigure[Ensayos 4 y 5]{\label{Fig:Ensayos:c} 
  \includegraphics[height=6cm]{Imagenes/Ensayo4y5.JPG} }

  \caption{Ensayos realizados para adquirir las señales a analizar}\label{Fig:Ensayos}
\end{figure}
\bigskip 

\section{Observaciones realizadas durante los ensayos }
Al principio los animales estaban muy inquietos e intimidados por nuestra presencia, lo que dificultó obtener datos relevantes (prácticamente no comieron ni rumiaron). 
Los ensayos 3, 4, 5 y 6 fueron los que más información nos brindaron, sin embargo los reproductores de mp4 solo pueden grabar sonidos hasta 8 kHz con un conversor de 8 bits mientras que el micrófono de PC con la PC tienen la capacidad de muestrear a 48 kHz, 16 bits. 

\section{Procesamiento digital de las señales }
Para analizar las señales obtenidas a partir de los ensayos mencionados anteriormente, se consultó al grupo de procesamiento de señales de la Facultad de Ingeniería. Nos recomendaron el software \textit{Wavesurfer} y con el mismo se observaron y obtuvieron los segmentos de las señales que aportaron información útil. 

En la figura \ref{Fig:SenalRumia} y en la figura \ref{Fig:SenalPastoreo} se pueden observar algunas secuencias representativas de las actividades de rumia y pastoreo respectivamente. 

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.7]{Imagenes/senalrumia.JPG} 

  \caption{\textbf{Rumia} - Segmento extraído del ensayo 4. En A se puede ver el espectrograma mientras que en B la señal en función del tiempo.}\label{Fig:SenalRumia} 
\end{figure}

\begin{figure}[ht]
  \centering
  \includegraphics[scale=0.45]{Imagenes/PastoreodeLap.JPG}  

  \caption{\textbf{Pastoreo} - Segmento extraído del ensayo 6. En A se puede ver el espectrograma mientras que en B la señal en función del tiempo.}\label{Fig:SenalPastoreo} 
\end{figure}

La figura \ref{Fig:SenalRumia} no nos brinda información sobre la frecuencia mínima de muestreo, pues se obtuvo el reproductor mp3 el cual muestrea a 8kHz. Sin embargo, se puede notar fácilmente que la señal presenta un patrón rítmico.

En la figura \ref{Fig:SenalPastoreo} a diferencia de la anterior, fue obtenida con el micrófono de PC, por eso presenta componentes de señal a mayor frecuencia. En este caso el componente de señal que corresponde exclusivamente al pastoreo tiene componentes en frecuencia de hasta 6 kHz.

El artículo \emph{``Computational method for segmentation and classification of ingestive sounds in sheep''}\cite{D.H.2009} propone un método novedoso para análizar y reconocer automaticamente señales sonoras emitidas por bovinos al realizar pastoreo y rumia. En el mismo se describen, por ejemplo, los materiales utilizados: videocámara y micrófono inalambrico. Luego las señales obtenidas fueron digitalizadas y analizadas utilizando el sofware \textit{Cool Edit Pro v2}, a una frecuencia de muestreo de 44,1kHz y una resolución de 16 bits.

En base a este artículo y las observaciones realizadas es que se decidió muestrear a 22 kHz y con una resolución de al menos 12 bits.
\bigskip 

\section{Requerimientos del hardware }

\begin{itemize}
\item Muestreo a 22kHz, al menos 12 bits. 
\item Memoria no volátil de 3,5 GB. 
\item Bajo consumo, menor a 1 W. 
\item Botones para la interfaz con el usuario (1 o 2). 
\item Real Time Clock o posibilidad de conectar uno. 
\end{itemize}

\section{Elección del hardware }
La primera opción que se planteó fue la de desarrollar el circuito mediante pics o procesadores, ADC o tarjetas de audio. Esta opción se descartó rápidamente debido al tiempo que insumira el diseño e implementación de la placa. 


Otra opción era la de basar nuestro desarrollo mediante el uso de grabadoras digitales de audio, reproductores de mp3, mp4 o celulares capaces de adquirir audio. Se descartó la utilización de grabadoras digitales de audio debido a su elevado costo y consumo. Para poder utilizar los reproductores de mp3 o mp4 se les debera instalar un nuevo firmware, con la finalidad de que pudiera ser modificado para muestrear a la frecuencia y cantidad de bits necesarios; pero de todas formas los dispositivos seguían sin cumplir con los requerimientos. Con respecto a los celulares, lo que nos llevó a descartar su utilización, fue su elevado consumo. 


La tercera opción que nos planteamos fue la de utilizar placas ya diseñadas capaces de grabar una memoria SD o que tuvieran interfaz USB, cuyo consumo fuera lo menor posible (ultra low power) y que incluyeran ADC o tarjeta de sonido capaz de muestrear de acuerdo a los requerimientos establecidos. 
Nuestra búsqueda inicial se basó en esta tercera opción y encontramos que la mayoría de las placas que incluían ADCs o tarjetas de sonido on-board o bien muestreaban a altas frecuencias pero con la cantidad insuficiente de bits, o a muy bajas frecuencias y 16 bits o más. De esta búsqueda concluimos que deberíamos incluir una tarjeta de sonido o ADCs externos a la placa para poder cumplir con los requerimientos. 


Los criterios principales de elección fueron:

 \begin{enumerate}
\item cumplir con los requerimientos del hardware 
\item costo de la placa 
\item costo de los kits necesarios para realizar la programación de la misma (pago de licencias de software) 
\item si soporta algún sistema operativo o si existen las libreras necesarias para el desarrollo del sistema embebido. Ver Tabla \ref{Tabla:TVD1} 
\end{enumerate}

\begin{table}[H]
\begin{center}

\begin{tabular}{|p{4cm}|p{4cm}|p{4cm}|}
\hline  & Ventajas  & Desventajas  \\ 
\hline  Realizar el sistema embebido completo 
& Al ser un sistema propio slo se desarrollaran las aplicaciones necesarias para el sistema, reduciendo as el espacio en memoria y optimizando el rendimiento del mismo 

 & El tiempo de desarrollo y testeo de errores sera mayor que usando un sistema operativo ya desarrollado 

 \\ 
\hline  Utilizar una placa capaz de soportar un sistema operativo ya diseado
&Agilitara el desarrollo de aplicaciones a ms alto nivel 

  &Tiene implementado funciones que no seran necesarias para nuestra aplicacin, ocupando mayor espacio en memoria y proceso innecesarios .
Nos facilita todas las comunicaciones con los puertos y transmisiones de datos.

  \\ 
\hline 

\end{tabular}
\caption{Ventajas y desventajas de realizar el sistema embebido completo o utilizar una placa que soporte un sistema operativo} \label{Tabla:TVD1} 
\end{center}
\end{table}




Por esta razón es que se decidió buscar single board computers las cuales soportaran alguno de los siguientes sistemas operativos: Windows ce, Windows embbedded o Linux. 
Las single board computers nos facilitan el desarrollo de las aplicaciones debido a que el sistema operativo ya tiene implementado funciones esenciales para el desarrollo planteado y ha sido testeado desde hace años. 

\section{Opciones consideradas }
En la tabla A continuación se muestran algunas placas que tomamos en consideración, para basar el desarrollo de nuestro proyecto.

\begin{table}[H]
\begin{center}

% use packages: array
\begin{tabular}{|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
\hline 
	&	\textbf{Gumstix Overo Earth} \cite{Gumstix2009}	& \textbf{Titan PC/104} \cite{Eurotech20092} 	& \textbf{PPM-LX800}\cite{WinSystem2009}	& \textbf{SAT 520PLUS}	\\ \hline
\textbf{Procesador}	&	ARM Cortex-A8 CPU 600 MHz	&	520MHz PXA270 XScale	&	AMD 500 MHz Geode LX800	&	AMD 133 MHz SC520	\\ \hline
\textbf{Memoria}	&	256 MB RAM 	&	Up to 128 MB SDRAM &	Up to 1028 MB SDRAM  	& Up to 256 MB SDRAM\\
	&	256 MB Flash 	&	Up to 64 MB of AMD MirrorBit Flash 	&		&		\\ \hline
\textbf{RTC}	&		&	Si	&		&	Si	\\ \hline
\textbf{ADC}	&	10 bits	&		&		&		\\ \hline
\textbf{SD	}&	2GB micro SD	&	SD/SDIO/MMC card socket 	&	Si	&	Si	\\ \hline
\textbf{USB}	&	USB HS Host	&	2x USB 1.1 	&	2 x 2.0 ports 	&		\\ \hline
\textbf{Tamaño (mmxmmxmm}	&	17x58x4.2	&	96x91 	&	90x96 	&	114x180 	\\ \hline
\textbf{Consumo	}&	1 W	&	1.5W	&	.9W	&		\\ \hline
\textbf{Sist. Operativos que soporta}	&		&	Windows CE and Linux	&	Windows XP, XP Embedded, Linux, DOS, x86 RTOS 	&	 Linux, DOS, x86 RTOS	\\ \hline


\end{tabular}
\caption{Comparación de posibles blacas}
\label{Tabla:Opc1:a} 
\end{center}
\end{table}

\begin{table}[H]
\begin{center}
\begin{tabular}{|p{2cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
\hline 		&	\textbf{UBW32}	&	\textbf{EPX-GX500}	&	\textbf{ARM TS-7260}\\ \hline	
\textbf{Procesador}	&	PIC 32 MX460F512L 80MH 	&	AMD GeodeTM GX500	&	 200Mhz ARM9 CPU 	\\ \hline
\textbf{Memoria}	&	512K Flash 	&	 Up to 512 MB SDRAM &	32MB SDRAM \\	&	32K RAM	&		&	32MB NAND Flash 	\\ \hline
\textbf{RTC}		&		&		&	Si	\\ \hline
\textbf{ADC}		&		&	12-bit	&	2 12-bit 	\\ \hline
\textbf{SD	}&		&	Si	&	Si	\\ \hline
\textbf{USB}		&		&	2 X  Two USB 1.1 ports 	&	2 USB 2.0 (12 Mbit/s max) 	\\ \hline
\textbf{Tamaño (mmxmmxmm}	 	&	7x30x30	&		&	95x120	\\ \hline
\textbf{Consumo	}&		&	1.0W 	&	0.25W at lower speed	\\ \hline
\textbf{Sist. Operativos que soporta}		&		&	Windows XP, XP Embedded, Linux, Windows CE, DOS, x86 RTOS 	&	Linux out-of-the-box	\\ \hline


\end{tabular}
\caption{Comparación de posibles blacas}
\label{Tabla:Opc1:b} 
\end{center}
\end{table}


Las baterías que se encuentran actualmente en venta en el mercado determinaron que el factor que comprometía más nuestro diseño era el consumo.

Dadas las capacidades de las baterías asociadas a un factor de forma y peso adecuados, junto con los voltajes de alimentación de las placas, llegamos a la conclusión que para que nuestro dispositivo tuviera al menos 24 hs de autonomía, necesitábamos un sistema que consumiera como máximo 1.5 W.

Luego de evaluar las placas anteriormente mencionadas y comprobar si cumplían los requerimientos estipulados (con pequeños agregados), se llegó a la conclusión que la placa TS-7260 de ARM y la tarjeta de sonido USB 3D Sound modelo HY554 eran la mejor opción dado los requerimientos para el desarrollo del proyecto.

Esta placa tiene instalado de fábrica el núcleo 2.4.26 de GNU/Linux, y está optimizado para la arquitectura de la misma y su consumo máximo se encuentra en el orden de 1 W.

A la hora de la elección de la batería, tuvimos la dificultad de encontrar una batería que cumpliera con el amperaje y voltaje deseados, junto con un peso y factor de forma adecuados; ya que otro de los requerimientos del proyecto es que el dispositivo completo pesara menos de 1 Kg.

Teniendo en cuenta todas estas limitantes, finalmente se optó por una batería con tecnología Li-ion (modelo 18650) de 7,4V y 4800 mAh la cual pesa 210 g y tiene un factor de forma aceptable: 40mmx40mmx70mm.

\section{Listado de compras}

